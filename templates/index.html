<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Titas Toys</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha384-..." crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
  </head>
  <style>
    body {
      background-color: #fcf4dd;
      font-family: Helvetica, Arial, sans-serif;
    }
    .titulos {
      font-size: 25px;
      text-align: center;
      color: #004a77ff;
      font-weight: bold;
    }
    
    .data {
      font-size: 17px;
      text-align: left;
      color: #000000;
    }
    
    body {
      background-color: #fbdbf0;
      font-family: Helvetica, Arial, sans-serif;
    }
    
    .headTr {
      background-color: #eb54ba;
      text-align: center;
      color: #fff;
    }
    
    .labelTd {
      font-size: 22px;
      text-align: left;
      color: #000;
    }
    
    .labelButtonsMenu {
      font-size: 28px;
      text-align: left;
      color: #fff;
    }
    
    .data {
      font-size: 16px;
      text-align: left;
      color: #000000;
    }

    .dataMedium {
      font-size: 18px;
      text-align: left;
      color: #000000;
  }
  
    
    .buttonTitle {
      font-size: 23px;
    }
    
    
    .titulos {
      font-size: 16px;
      text-align: center;
      color: #fff;
      font-weight: bold;
    }
    .centrado {
      text-align: center;
    }
    
    .izquierdo {
      text-align: left;
    }
    
    .bgMorado {
      background-color: #e20099;
    }
    
    .bgMoradoMedio {
      background-color: #eb54ba;
    }
    
    .btnNavegacion {
      background-color: #e733ad;
      width: 120px;
    }
    
    video {
      width: 100%;
    }
    
    .imagen-redondeada {
      border-radius: 25px; /* Redondea las esquinas */
      width: 90px; /* Ancho de la imagen */
      height: 70px;
    }
  </style>
  <body>
    <div class="panel panel-info col-sm-12" id="divFormulario">
      <div class="bgMorado centrado" style="height: 125px;">
        <br />
        <img src="/static/titas.jpg" class="imagen-redondeada" /> &nbsp;
        <label class="titulosEncabezado">Tita's Toys</label>
      </div>
      <!-- Div Menu navegacion -->
      <div class="izquierdo">
        <table>
          <tr>
            <td>
              <form action="/menu" method="POST">
                <input type="hidden" name="menuNavegacion" id="menuNavegacion" value="0" />
                <button type="submit" class="btn btnMorado titulosBotones" id="btnMenuAlta">
                  <i class="fa fa-cog fa-2x titulos"></i>
                  <label class="titulos">Men&uacute;</label>
                </button>
              </form>
            </td>
          </tr>
        </table>
      </div> <!-- cierra  div izquierdo -->

      <div class="panel-body" id="divPanelBody">
        <!-- Formulario para entrada de datos -->
        <div class="panel panel-info col-sm-12">
          <label class="labels"><h3>Alta de productos</h3></label> &nbsp; <button type="button" id="start-camera" class="btn btn-sm btnMorado titulosBotones" data-toggle="modal" data-target="#myModal"><i class="fa fa-camera fa-2x titulos"></i></button>
          <br />
          <form action="/altaInventario" method="post">
            <!-- Código de barras -->
            <label for="barcode" class="labels"><h4>Código de barras:</h4></label>
            <input type="number" class="form-control data inputsMedianos" id="barcode" name="barcode" autofocus required value="" />
            <br />

            <!-- Nombre del producto -->
            <label for="product-name" class="labels"><h4>Nombre del producto:</h4></label>
            <input type="text" class="form-control data inputsMedianos" id="product-name" name="productName" required value="" />
            <br />

            <!-- Cantidad con spinner -->
            <label for="quantity" class="labels"><h4>Cantidad:</h4></label>
            <input type="number" class="form-control dataMedium inputsMedianos" id="quantity" name="quantity" min="1" value="1" required value="" size="6" />
            <br />

            <!-- Precio -->
            <label for="price" class="labels"><h4>Precio: $</h4></label>
            <input type="number" class="form-control dataMedium inputsMedianos" id="price" name="price" required value="" size="6" />
            <br />

            <!-- Botón para enviar -->
            <div style="text-align: right;">
              <button type="submit" class="btn btnMorado titulosBotones"><i class="fa fa-plus" aria-hidden="true"></i> &nbsp; Agregar</button>
            </div> <!-- Botón para enviar -->
          </form>
          <br /><br />
        </div> <!-- fin div Formulario para entrada de datos -->
      </div> <!-- fin divPanelBody -->
    </div>
</div>

    <div class="container">
      <!-- Modal -->
      <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">
          <!-- Modal content -->
          <div class="modal-content" style="text-align: center; width:300px; height:400px;">
            <div class="modal-header">
              <button type="button" id="stop-camera" class="close" data-dismiss="modal">&times;</button>
              <h4>Acerca el código de barras</h4>
            </div>
            <div class="modal-body" style="width:300px;  height: 250px; text-align: center;">
              <!-- Contenedor para el video -->
              <!-- Codigo anterior para mostrar la camara
              <div id="camera-container">
                <div id="video-container" style="width: 100%; height: 230px;"></div>
              </div> -->

              <div id="qr-reader" style="width:250px; height: 200px;"></div>
              <div id="qr-reader-results"></div>

            </div>
            <div class="modal-footer"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      $('#start-camera').on('click', function () {
        $('#html5-qrcode-button-camera-stop').html('Detener')
        $('#html5-qrcode-button-camera-stop').trigger('click')
        $('#html5-qrcode-button-camera-start').html('Escanear')
       
      });
    </script>

    <script>
      $('#html5-qrcode-button-camera-start').on('click', function () {
        $('#html5-qrcode-button-camera-stop').remove()
       
      });
    </script>

<!--
    <script>
      $(document).ready(function () {
        let isCameraActive = true
      
        // Iniciar la cámara
        $('#start-camera').on('click', function () {
          $('#camera-container').show()
          $('#stop-camera').show()
      
          // Configurar QuaggaJS
          Quagga.init(
            {
              inputStream: {
                name: 'Live',
                type: 'LiveStream',
                target: document.querySelector('#video-container') // Contenedor del video
              },
              decoder: {
                readers: ['code_128_reader', 'ean_reader'] // Tipos de códigos de barras
              }
            },
            function (err) {
              if (err) {
                console.error(err)
                alert('Error al iniciar la cámara.')
                return
              }
              Quagga.start()
            }
          )
      
          // Detectar códigos de barras
          Quagga.onDetected(function (data) {
            const barcode = data.codeResult.code
            $('#scanned-barcode').text(barcode) // Mostrar el código escaneado
            $('#barcode').val(barcode) // Rellenar el campo de entrada
            Quagga.stop() // Detener la cámara después de escanear
            $('#camera-container').hide()
            $('#stop-camera').hide()
            $('#start-camera').show()
            $('#stop-camera').trigger('click')
          })
        })
      
        // Detener la cámara
        $('#stop-camera').on('click', function () {
          if (isCameraActive) {
            Quagga.stop()
            $('#camera-container').hide()
            $('#stop-camera').hide()
            $('#start-camera').show()
            $('#myModal').hide()
            isCameraActive = false
          }
        })
      })
    </script> -->
    <script>
    
      var resultContainer = document.getElementById('qr-reader-results')
      var lastResult,
        countResults = 0
      
      function onScanSuccess(decodedText, decodedResult) {
        if (decodedText !== lastResult) {
          ++countResults
          lastResult = decodedText
          // Handle on success condition with the decoded message.      
        }
       
        $('#barcode').val(decodedText);
        $('#html5-qrcode-button-camera-stop').html('Detener')
        $('#myModal').modal('hide');
      }
      
      var html5QrcodeScanner = new Html5QrcodeScanner('qr-reader', { fps: 10, qrbox: 350 })
      html5QrcodeScanner.render(onScanSuccess)

    </script>
  </body>
</html>
